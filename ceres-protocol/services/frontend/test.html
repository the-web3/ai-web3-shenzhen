<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ceres AI Demo - æµ‹è¯•é¡µé¢</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      button:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }
      pre {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª Ceres AI Demo æµ‹è¯•é¡µé¢</h1>

    <div class="test-section">
      <h2>ğŸ”— APIè¿æ¥æµ‹è¯•</h2>
      <button onclick="testAPIConnection()">æµ‹è¯•APIè¿æ¥</button>
      <div id="apiStatus"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ¯ ç«äº‰æ€§åˆ¤æ–­æµ‹è¯•</h2>
      <button onclick="testCompetitiveJudgment()">æµ‹è¯•ç«äº‰æ€§åˆ¤æ–­</button>
      <div id="competitiveResult"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ“ˆ è¶‹åŠ¿åˆ†ææµ‹è¯•</h2>
      <button onclick="testTrendAnalysis()">æµ‹è¯•è¶‹åŠ¿åˆ†æ</button>
      <div id="trendResult"></div>
    </div>

    <div class="test-section">
      <h2>ğŸŒ å¤–éƒ¨çƒ­ç‚¹æµ‹è¯•</h2>
      <button onclick="testExternalHotspot()">æµ‹è¯•å¤–éƒ¨çƒ­ç‚¹</button>
      <div id="hotspotResult"></div>
    </div>

    <div class="test-section">
      <h2>ğŸš€ å®Œæ•´æ¼”ç¤º</h2>
      <button onclick="runFullDemo()">è¿è¡Œå®Œæ•´æ¼”ç¤º</button>
      <div id="fullDemoResult"></div>
    </div>

    <script>
      const API_BASE = "http://localhost:8000/api";

      async function callAPI(endpoint) {
        try {
          const response = await fetch(`${API_BASE}${endpoint}`);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          return await response.json();
        } catch (error) {
          throw error;
        }
      }

      function showResult(elementId, success, message, data = null) {
        const element = document.getElementById(elementId);
        const statusClass = success ? "success" : "error";
        let html = `<div class="status ${statusClass}">${message}</div>`;

        if (data) {
          html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        element.innerHTML = html;
      }

      async function testAPIConnection() {
        try {
          const result = await callAPI("/status");
          showResult("apiStatus", true, "âœ… APIè¿æ¥æˆåŠŸ", result);
        } catch (error) {
          showResult("apiStatus", false, `âŒ APIè¿æ¥å¤±è´¥: ${error.message}`);
        }
      }

      async function testCompetitiveJudgment() {
        try {
          const result = await callAPI("/demo/competitive");
          showResult(
            "competitiveResult",
            true,
            "âœ… ç«äº‰æ€§åˆ¤æ–­æµ‹è¯•æˆåŠŸ",
            result,
          );
        } catch (error) {
          showResult(
            "competitiveResult",
            false,
            `âŒ ç«äº‰æ€§åˆ¤æ–­æµ‹è¯•å¤±è´¥: ${error.message}`,
          );
        }
      }

      async function testTrendAnalysis() {
        try {
          const result = await callAPI("/demo/trend");
          showResult("trendResult", true, "âœ… è¶‹åŠ¿åˆ†ææµ‹è¯•æˆåŠŸ", result);
        } catch (error) {
          showResult(
            "trendResult",
            false,
            `âŒ è¶‹åŠ¿åˆ†ææµ‹è¯•å¤±è´¥: ${error.message}`,
          );
        }
      }

      async function testExternalHotspot() {
        try {
          const result = await callAPI("/demo/hotspot");
          showResult("hotspotResult", true, "âœ… å¤–éƒ¨çƒ­ç‚¹æµ‹è¯•æˆåŠŸ", result);
        } catch (error) {
          showResult(
            "hotspotResult",
            false,
            `âŒ å¤–éƒ¨çƒ­ç‚¹æµ‹è¯•å¤±è´¥: ${error.message}`,
          );
        }
      }

      async function runFullDemo() {
        const resultDiv = document.getElementById("fullDemoResult");
        resultDiv.innerHTML =
          '<div class="status warning">ğŸ”„ æ­£åœ¨è¿è¡Œå®Œæ•´æ¼”ç¤º...</div>';

        try {
          // æµ‹è¯•æ‰€æœ‰APIç«¯ç‚¹
          const tests = [
            { name: "APIè¿æ¥", endpoint: "/status" },
            { name: "ç«äº‰æ€§åˆ¤æ–­", endpoint: "/demo/competitive" },
            { name: "è¶‹åŠ¿åˆ†æ", endpoint: "/demo/trend" },
            { name: "å¤–éƒ¨çƒ­ç‚¹", endpoint: "/demo/hotspot" },
          ];

          const results = [];
          for (const test of tests) {
            try {
              const result = await callAPI(test.endpoint);
              results.push({ name: test.name, success: true, data: result });
            } catch (error) {
              results.push({
                name: test.name,
                success: false,
                error: error.message,
              });
            }
          }

          // æ˜¾ç¤ºç»“æœ
          let html = "<h3>ğŸ“Š å®Œæ•´æ¼”ç¤ºç»“æœ:</h3>";
          let successCount = 0;

          results.forEach((result) => {
            if (result.success) {
              successCount++;
              html += `<div class="status success">âœ… ${result.name}: æˆåŠŸ</div>`;
            } else {
              html += `<div class="status error">âŒ ${result.name}: ${result.error}</div>`;
            }
          });

          html += `<div class="status ${successCount === tests.length ? "success" : "warning"}">
                    ğŸ“ˆ æˆåŠŸç‡: ${successCount}/${tests.length} (${Math.round((successCount / tests.length) * 100)}%)
                </div>`;

          resultDiv.innerHTML = html;
        } catch (error) {
          showResult(
            "fullDemoResult",
            false,
            `âŒ å®Œæ•´æ¼”ç¤ºå¤±è´¥: ${error.message}`,
          );
        }
      }

      // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•APIè¿æ¥
      window.addEventListener("load", () => {
        setTimeout(testAPIConnection, 1000);
      });
    </script>
  </body>
</html>

# ğŸŒŸ TruthArena V2 - åŠ¨æ€åˆ†å±‚ç”Ÿæ¯ç­–ç•¥

## ğŸ“Š ç­–ç•¥æ¦‚è¿°

TruthArenaV2 å®ç°äº†æ™ºèƒ½çš„åŠ¨æ€åˆ†å±‚ç”Ÿæ¯ç­–ç•¥ï¼Œæ ¹æ®å¸‚åœºå‘¨æœŸå’Œèµ„é‡‘æ± è§„æ¨¡è‡ªåŠ¨å†³å®šæ˜¯å¦å¯ç”¨ç”Ÿæ¯åŠŸèƒ½ã€‚

---

## ğŸ¯ åˆ†å±‚ç­–ç•¥é…ç½®

### **ä¸‰å±‚ç­–ç•¥**

| å±‚çº§ | å¸‚åœºå‘¨æœŸ | èµ„é‡‘æ± ä¸´ç•Œç‚¹ | ç­–ç•¥ |
|------|---------|-------------|------|
| **çŸ­æœŸ** | â‰¤ 7å¤© | 5 ETH | é«˜é—¨æ§›ï¼Œé¿å…çŸ­æœŸæˆæœ¬ |
| **ä¸­æœŸ** | 8-30å¤© | 1 ETH | ä¸­é—¨æ§›ï¼Œå¹³è¡¡æ”¶ç›Š |
| **é•¿æœŸ** | > 30å¤© | 0.5 ETH | ä½é—¨æ§›ï¼Œæœ€å¤§åŒ–æ”¶ç›Š |

---

## ğŸ’° æ”¶ç›Šåˆ†æ

### **ç¤ºä¾‹ 1ï¼šçŸ­æœŸå¸‚åœºï¼ˆ7å¤©ï¼Œ5 ETHï¼‰**
```
èµ„é‡‘æ± ï¼š5 ETH
å¹´åŒ–æ”¶ç›Šç‡ï¼š3%
å¸‚åœºå‘¨æœŸï¼š7å¤©

åˆ©æ¯æ”¶å…¥ï¼š5 Ã— 3% Ã— 7/365 = 0.00288 ETH â‰ˆ $7.2
é¢å¤– Gasï¼š~$0.00002
å‡€æ”¶ç›Šï¼š$7.19998
æ”¶ç›Šç‡ï¼š0.144%ï¼ˆ7å¤©ï¼‰
```

### **ç¤ºä¾‹ 2ï¼šä¸­æœŸå¸‚åœºï¼ˆ30å¤©ï¼Œ1 ETHï¼‰**
```
èµ„é‡‘æ± ï¼š1 ETH
å¹´åŒ–æ”¶ç›Šç‡ï¼š3%
å¸‚åœºå‘¨æœŸï¼š30å¤©

åˆ©æ¯æ”¶å…¥ï¼š1 Ã— 3% Ã— 30/365 = 0.00246 ETH â‰ˆ $6.15
é¢å¤– Gasï¼š~$0.00002
å‡€æ”¶ç›Šï¼š$6.14998
æ”¶ç›Šç‡ï¼š0.246%ï¼ˆ30å¤©ï¼‰
```

### **ç¤ºä¾‹ 3ï¼šé•¿æœŸå¸‚åœºï¼ˆ90å¤©ï¼Œ0.5 ETHï¼‰**
```
èµ„é‡‘æ± ï¼š0.5 ETH
å¹´åŒ–æ”¶ç›Šç‡ï¼š3%
å¸‚åœºå‘¨æœŸï¼š90å¤©

åˆ©æ¯æ”¶å…¥ï¼š0.5 Ã— 3% Ã— 90/365 = 0.00370 ETH â‰ˆ $9.25
é¢å¤– Gasï¼š~$0.00002
å‡€æ”¶ç›Šï¼š$9.24998
æ”¶ç›Šç‡ï¼š0.740%ï¼ˆ90å¤©ï¼‰
```

---

## ğŸ”§ å·¥ä½œåŸç†

### **1. å¸‚åœºåˆ›å»º**
```solidity
// åˆ›å»ºå¸‚åœºæ—¶ï¼ŒyieldEnabled é»˜è®¤ä¸º false
market.yieldEnabled = false;
```

### **2. ç”¨æˆ·ä¸‹æ³¨**
```solidity
// æ¯æ¬¡ä¸‹æ³¨åï¼Œæ£€æŸ¥æ˜¯å¦è¾¾åˆ°ä¸´ç•Œç‚¹
_checkAndEnableYield(marketId);
```

### **3. ä¸´ç•Œç‚¹æ£€æŸ¥**
```solidity
function _checkAndEnableYield(uint256 _marketId) internal {
    // 1. è®¡ç®—æ€»èµ„é‡‘æ± 
    uint256 totalPool = market.yesPool + market.noPool;
    
    // 2. è·å–å¸‚åœºå‘¨æœŸ
    uint256 marketDuration = market.endTime - market.createdAt;
    
    // 3. æ ¹æ®å‘¨æœŸç¡®å®šä¸´ç•Œç‚¹
    uint256 threshold = _getYieldThreshold(marketDuration);
    
    // 4. å¦‚æœè¾¾åˆ°ä¸´ç•Œç‚¹ï¼Œå¯ç”¨ç”Ÿæ¯
    if (totalPool >= threshold) {
        market.yieldEnabled = true;
        // TODO: å­˜å…¥ç”Ÿæ¯åè®®
    }
}
```

### **4. ä¸´ç•Œç‚¹è®¡ç®—**
```solidity
function _getYieldThreshold(uint256 _duration) internal view returns (uint256) {
    // çŸ­æœŸå¸‚åœºï¼ˆâ‰¤7å¤©ï¼‰ï¼š5 ETH
    if (_duration <= 7 days) return 5 ether;
    
    // ä¸­æœŸå¸‚åœºï¼ˆâ‰¤30å¤©ï¼‰ï¼š1 ETH
    if (_duration <= 30 days) return 1 ether;
    
    // é•¿æœŸå¸‚åœºï¼ˆ>30å¤©ï¼‰ï¼š0.5 ETH
    return 0.5 ether;
}
```

---

## ğŸ“‹ åˆçº¦æ–°å¢åŠŸèƒ½

### **1. åˆ†å±‚ç­–ç•¥é…ç½®**
```solidity
struct YieldTier {
    uint256 duration;      // å¸‚åœºå‘¨æœŸï¼ˆç§’ï¼‰
    uint256 threshold;     // èµ„é‡‘æ± ä¸´ç•Œç‚¹
}

YieldTier[3] public yieldTiers;
```

### **2. ç”Ÿæ¯çŠ¶æ€è¿½è¸ª**
```solidity
struct Market {
    // ... å…¶ä»–å­—æ®µ
    bool yieldEnabled;  // æ˜¯å¦å¯ç”¨ç”Ÿæ¯
}
```

### **3. ç®¡ç†åŠŸèƒ½**
```solidity
// æ›´æ–°åˆ†å±‚ç­–ç•¥é…ç½®
function updateYieldTier(
    uint256 _tierIndex,
    uint256 _duration,
    uint256 _threshold
) external onlyOwner

// æŸ¥è¯¢åˆ†å±‚ç­–ç•¥é…ç½®
function getYieldTier(uint256 _tierIndex) external view returns (
    uint256 duration,
    uint256 threshold
)
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### **1. ç¼–è¯‘åˆçº¦**
```bash
cd contracts
npm run compile
```

### **2. éƒ¨ç½²åˆ°æµ‹è¯•ç½‘**
```bash
# ä¿®æ”¹ deploy.jsï¼Œå°† TruthArena æ”¹ä¸º TruthArenaV2
npm run deploy:sepolia
```

### **3. éªŒè¯é…ç½®**
```javascript
// æŸ¥è¯¢åˆ†å±‚ç­–ç•¥
const tier0 = await contract.getYieldTier(0);
console.log("çŸ­æœŸå¸‚åœº:", tier0.duration, tier0.threshold);

const tier1 = await contract.getYieldTier(1);
console.log("ä¸­æœŸå¸‚åœº:", tier1.duration, tier1.threshold);

const tier2 = await contract.getYieldTier(2);
console.log("é•¿æœŸå¸‚åœº:", tier2.duration, tier2.threshold);
```

---

## ğŸ” å®‰å…¨è€ƒè™‘

### **1. ä¸´ç•Œç‚¹ä¿æŠ¤**
- âœ… åªæœ‰è¾¾åˆ°ä¸´ç•Œç‚¹æ‰å¯ç”¨ç”Ÿæ¯
- âœ… é¿å…å°é¢èµ„é‡‘æ± çš„é«˜æˆæœ¬

### **2. æƒé™æ§åˆ¶**
- âœ… åªæœ‰ owner å¯ä»¥æ›´æ–°åˆ†å±‚ç­–ç•¥
- âœ… é˜²æ­¢æ¶æ„ä¿®æ”¹ä¸´ç•Œç‚¹

### **3. çŠ¶æ€ä¸€è‡´æ€§**
- âœ… ä¸€æ—¦å¯ç”¨ç”Ÿæ¯ï¼ŒçŠ¶æ€ä¸å¯é€†
- âœ… ç¡®ä¿èµ„é‡‘å®‰å…¨

---

## ğŸ“ˆ æœªæ¥æ‰©å±•

### **é˜¶æ®µ 1ï¼šé›†æˆ Lido stETH**
```solidity
// å­˜å…¥ç”Ÿæ¯åè®®
function _depositToYieldProtocol(uint256 amount) internal {
    ILido(LIDO_ADDRESS).submit{value: amount}(address(0));
}

// æå–èµ„é‡‘
function _withdrawFromYieldProtocol(uint256 marketId) internal {
    // ä» Lido æå– stETH
    // è½¬æ¢å› ETH
}
```

### **é˜¶æ®µ 2ï¼šå¤šåè®®æ”¯æŒ**
- Lido (stETH)
- Rocket Pool (rETH)
- Aave (aToken)

### **é˜¶æ®µ 3ï¼šç”¨æˆ·è‡ªå®šä¹‰**
- ç”¨æˆ·é€‰æ‹©æ˜¯å¦å¯ç”¨ç”Ÿæ¯
- ç”¨æˆ·é€‰æ‹©ç”Ÿæ¯åè®®
- çµæ´»çš„ä¸´ç•Œç‚¹é…ç½®

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### **åˆ›å»ºå¸‚åœºæ—¶**
1. è¯„ä¼°é¢„æœŸèµ„é‡‘æ± è§„æ¨¡
2. é€‰æ‹©åˆé€‚çš„å¸‚åœºå‘¨æœŸ
3. äº†è§£ç”Ÿæ¯ä¸´ç•Œç‚¹

### **ä¸‹æ³¨æ—¶**
1. æŸ¥çœ‹å¸‚åœºæ˜¯å¦å·²å¯ç”¨ç”Ÿæ¯
2. äº†è§£æ½œåœ¨çš„é¢å¤–æ”¶ç›Š
3. è€ƒè™‘å¸‚åœºå‘¨æœŸå’Œæ”¶ç›Šç‡

### **é¢†å–å¥–åŠ±æ—¶**
1. å¦‚æœå¯ç”¨äº†ç”Ÿæ¯ï¼Œå¥–åŠ±åŒ…å«åˆ©æ¯
2. åˆ©æ¯æŒ‰ä»½é¢æ¯”ä¾‹åˆ†é…
3. æ— éœ€é¢å¤–æ“ä½œ

---

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### **å…³é”®æŒ‡æ ‡**
- å¯ç”¨ç”Ÿæ¯çš„å¸‚åœºæ•°é‡
- å¹³å‡èµ„é‡‘æ± è§„æ¨¡
- æ€»ç”Ÿæ¯æ”¶ç›Š
- Gas æˆæœ¬å æ¯”

### **ä¼˜åŒ–æ–¹å‘**
- æ ¹æ®å®é™…æ•°æ®è°ƒæ•´ä¸´ç•Œç‚¹
- ä¼˜åŒ– Gas æ¶ˆè€—
- æé«˜ç”Ÿæ¯æ”¶ç›Šç‡

---

## ğŸ¯ æ€»ç»“

TruthArenaV2 çš„åŠ¨æ€åˆ†å±‚ç”Ÿæ¯ç­–ç•¥ï¼š
- âœ… **æ™ºèƒ½åŒ–** - è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦å¯ç”¨
- âœ… **ä¼˜åŒ–æˆæœ¬** - é¿å…å°é¢èµ„é‡‘æ± æµªè´¹
- âœ… **æœ€å¤§åŒ–æ”¶ç›Š** - é•¿æœŸå¤§é¢å¸‚åœºå……åˆ†åˆ©ç”¨
- âœ… **ç”¨æˆ·å‹å¥½** - æ— éœ€æ‰‹åŠ¨é…ç½®

**ä¸´ç•Œç‚¹è®¾å®šï¼š**
- çŸ­æœŸï¼ˆâ‰¤7å¤©ï¼‰ï¼š5 ETH
- ä¸­æœŸï¼ˆ8-30å¤©ï¼‰ï¼š1 ETH
- é•¿æœŸï¼ˆ>30å¤©ï¼‰ï¼š0.5 ETH
